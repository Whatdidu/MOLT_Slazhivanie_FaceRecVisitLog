{% extends "admin/base.html" %}

{% block title %}Dashboard{% endblock %}
{% block page_title %}Dashboard{% endblock %}

{% block content %}
<!-- Stats Cards -->
<div class="row g-4 mb-4">
    <div class="col-md-6 col-lg-3">
        <div class="card stat-card">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="stat-icon bg-primary bg-opacity-10 text-primary me-3">
                        <i class="bi bi-people-fill"></i>
                    </div>
                    <div>
                        <div class="stat-value">{{ present_count }}</div>
                        <div class="stat-label">В офисе сейчас</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-6 col-lg-3">
        <div class="card stat-card">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="stat-icon bg-success bg-opacity-10 text-success me-3">
                        <i class="bi bi-person-check-fill"></i>
                    </div>
                    <div>
                        <div class="stat-value">{{ total_employees }}</div>
                        <div class="stat-label">Всего сотрудников</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-6 col-lg-3">
        <div class="card stat-card">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="stat-icon bg-info bg-opacity-10 text-info me-3">
                        <i class="bi bi-door-open-fill"></i>
                    </div>
                    <div>
                        <div class="stat-value">{{ today_entries }}</div>
                        <div class="stat-label">Входов сегодня</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-6 col-lg-3">
        <div class="card stat-card">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="stat-icon bg-warning bg-opacity-10 text-warning me-3">
                        <i class="bi bi-calendar-check"></i>
                    </div>
                    <div>
                        <div class="stat-value">{{ current_date }}</div>
                        <div class="stat-label">Сегодня</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row g-4">
    <!-- Present Employees -->
    <div class="col-lg-6">
        <div class="card table-card h-100">
            <div class="card-header d-flex justify-content-between align-items-center">
                <span><i class="bi bi-people me-2"></i>Сейчас в офисе</span>
                <a href="/admin/present" class="btn btn-sm btn-outline-primary">Все</a>
            </div>
            <div class="card-body p-0">
                {% if present_employees %}
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>Сотрудник</th>
                                <th>Время входа</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for emp in present_employees[:5] %}
                            <tr>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="avatar me-2">
                                            {{ emp.employee_name[:1] | upper }}
                                        </div>
                                        {{ emp.employee_name }}
                                    </div>
                                </td>
                                <td>
                                    {% if emp.last_event_time %}
                                    {{ emp.last_event_time.strftime('%H:%M') }}
                                    {% else %}
                                    —
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-4 text-muted">
                    <i class="bi bi-inbox fs-1"></i>
                    <p class="mt-2 mb-0">Офис пуст</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Recent Activity -->
    <div class="col-lg-6">
        <div class="card table-card h-100">
            <div class="card-header d-flex justify-content-between align-items-center">
                <span><i class="bi bi-activity me-2"></i>Последние события</span>
                <a href="/admin/attendance" class="btn btn-sm btn-outline-primary">Журнал</a>
            </div>
            <div class="card-body p-0">
                {% if recent_logs %}
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>Сотрудник</th>
                                <th>Событие</th>
                                <th>Время</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for log in recent_logs[:5] %}
                            <tr>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="avatar me-2">
                                            {{ log.employee_name[:1] | upper if log.employee_name else '?' }}
                                        </div>
                                        {{ log.employee_name or 'Unknown' }}
                                    </div>
                                </td>
                                <td>
                                    {% if log.event_type.value == 'entry' %}
                                    <span class="badge bg-success">Вход</span>
                                    {% else %}
                                    <span class="badge bg-secondary">Выход</span>
                                    {% endif %}
                                </td>
                                <td>{{ log.timestamp.strftime('%H:%M:%S') }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-4 text-muted">
                    <i class="bi bi-inbox fs-1"></i>
                    <p class="mt-2 mb-0">Нет событий</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Auto-refresh every 30 seconds
    setTimeout(() => location.reload(), 30000);
</script>
{% endblock %}
