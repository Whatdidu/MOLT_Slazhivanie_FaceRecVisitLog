# –ó–∞–¥–∞—á–∏ –º–æ–¥—É–ª—è Infrastructure (–¢–∞—Ç—å—è–Ω–∞)

**–í–µ—Ç–∫–∞:** `feature/infrastructure`

## –°—Ç–∞—Ç—É—Å—ã
- [ ] –ù–µ –Ω–∞—á–∞—Ç–æ
- [x] –í—ã–ø–æ–ª–Ω–µ–Ω–æ
- [~] –í –ø—Ä–æ—Ü–µ—Å—Å–µ

---

## –§–∞–∑–∞ 1: –ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

- [x] **TASK-INF-001**: –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–∞–ø–æ–∫ `app/core/`
- [x] **TASK-INF-002**: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —á–µ—Ä–µ–∑ `.env` (`app/core/config.py`)
- [x] **TASK-INF-003**: –°–æ–∑–¥–∞—Ç—å `.env.example` —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- [x] **TASK-INF-004**: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ª–æ–≥–≥–µ—Ä —Å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ —É—Ä–æ–≤–Ω—è–º–∏ (`app/core/logger.py`)

## –§–∞–∑–∞ 2: FastAPI –∫–∞—Ä–∫–∞—Å

- [x] **TASK-INF-005**: –°–æ–∑–¥–∞—Ç—å —Ç–æ—á–∫—É –≤—Ö–æ–¥–∞ `app/main.py` —Å –±–∞–∑–æ–≤—ã–º FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º
- [x] **TASK-INF-006**: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å CORS middleware
- [x] **TASK-INF-007**: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–æ—É—Ç–µ—Ä–æ–≤ –º–æ–¥—É–ª–µ–π (recognition, employees, attendance)
- [x] **TASK-INF-008**: –°–æ–∑–¥–∞—Ç—å health-check —ç–Ω–¥–ø–æ–∏–Ω—Ç (`GET /health`)

## –§–∞–∑–∞ 3: –ü—Ä–∏–µ–º–Ω—ã–π —à–ª—é–∑ (Image Gateway)

- [x] **TASK-INF-009**: –°–æ–∑–¥–∞—Ç—å —ç–Ω–¥–ø–æ–∏–Ω—Ç –ø—Ä–∏–µ–º–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –æ—Ç –∫–∞–º–µ—Ä—ã (`POST /api/v1/gateway/snapshot`)
- [x] **TASK-INF-010**: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–∞—Ä—Å–∏–Ω–≥ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤—Ö–æ–¥—è—â–∏—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (—Ä–∞–∑–º–µ—Ä, —Ñ–æ—Ä–º–∞—Ç)
- [x] **TASK-INF-011**: –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –∫–∞—á–µ—Å—Ç–≤–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ)
- [x] **TASK-INF-012**: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é Trace ID –¥–ª—è —Å–∫–≤–æ–∑–Ω–æ–≥–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤

## –§–∞–∑–∞ 4: Docker –∏ Infrastructure

- [x] **TASK-INF-013**: –°–æ–∑–¥–∞—Ç—å `Dockerfile` –¥–ª—è Python-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- [x] **TASK-INF-014**: –°–æ–∑–¥–∞—Ç—å `docker-compose.yml` (App + PostgreSQL)
- [x] **TASK-INF-015**: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Docker-–ø–æ—Ä—Ç—ã –∏ —Å–µ—Ç–µ–≤—É—é —Å–≤—è–∑–Ω–æ—Å—Ç—å –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏
- [x] **TASK-INF-016**: –î–æ–±–∞–≤–∏—Ç—å volume –¥–ª—è –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ë–î

## –§–∞–∑–∞ 5: –£—Ç–∏–ª–∏—Ç—ã –∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã

- [x] **TASK-INF-017**: –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª –∫–æ–Ω—Å—Ç–∞–Ω—Ç (`app/core/constants.py`)
- [x] **TASK-INF-018**: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å middleware –¥–ª—è Trace ID (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å)
- [x] **TASK-INF-019**: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –∏ exception handlers
- [x] **TASK-INF-020**: –°–æ–∑–¥–∞—Ç—å `requirements.txt` —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏ –ø—Ä–æ–µ–∫—Ç–∞

## –§–∞–∑–∞ 6: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥—Ä—É–≥–∏–º–∏ –º–æ–¥—É–ª—è–º–∏

- [ ] **TASK-INF-021**: –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Ä–æ—É—Ç–µ—Ä –º–æ–¥—É–ª—è Recognition (–ø–æ—Å–ª–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –ú–∞–Ω—Å—É—Ä–∞)
- [ ] **TASK-INF-022**: –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Ä–æ—É—Ç–µ—Ä –º–æ–¥—É–ª—è Employees (–ø–æ—Å–ª–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –û–ª—å–≥–∏)
- [x] **TASK-INF-023**: –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Ä–æ—É—Ç–µ—Ä –º–æ–¥—É–ª—è Attendance (–ø–æ—Å–ª–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –õ–∏–ª–∏)
- [ ] **TASK-INF-024**: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å pipeline: Gateway ‚Üí Recognition ‚Üí Attendance

## –§–∞–∑–∞ 7: –î–µ–ø–ª–æ–π –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

- [x] **TASK-INF-025**: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–µ–ø–ª–æ–π –Ω–∞ VPS —Å–µ—Ä–≤–µ—Ä
- [x] **TASK-INF-026**: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å nginx reverse proxy (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- [x] **TASK-INF-027**: –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤
- [ ] **TASK-INF-028**: –ü—Ä–æ–≤–µ—Å—Ç–∏ –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π API (–∫–æ–Ω—Ç—Ä–∞–∫—Ç –¥–ª—è –¥—Ä—É–≥–∏—Ö –º–æ–¥—É–ª–µ–π)

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ Core

```python
from app.core.config import settings      # –î–æ—Å—Ç—É–ø –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º
from app.core.logger import get_logger    # –ü–æ–ª—É—á–µ–Ω–∏–µ –ª–æ–≥–≥–µ—Ä–∞
from app.core.constants import *          # –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞
from app.core.exceptions import AppException  # –ë–∞–∑–æ–≤–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ
```

### Trace ID Middleware

```python
# –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –ø–æ–ª—É—á–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π trace_id
# –î–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ request.state.trace_id
# –î–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –æ—Ç–≤–µ—Ç–∞ X-Trace-ID
# –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –æ—Ç–ª–∞–¥–∫–∏
```

### Gateway Service

```python
# POST /api/v1/gateway/snapshot
# –ü—Ä–∏–Ω–∏–º–∞–µ—Ç: UploadFile (image/jpeg, image/png, image/webp)
# –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: SnapshotResponse —Å trace_id –∏ —Å—Ç–∞—Ç—É—Å–æ–º
# –í–∞–ª–∏–¥–∞—Ü–∏—è: —Ä–∞–∑–º–µ—Ä –¥–æ 10MB, –º–∏–Ω–∏–º—É–º 100x100px
```

---

## API Endpoints

```
GET  /health                        - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–∞
GET  /api/v1/info                   - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–µ—Ä—Å–∏–∏ –∏ —Å—Ç–∞—Ç—É—Å–µ
POST /api/v1/gateway/snapshot       - –ü—Ä–∏–µ–º —Å–Ω–∞–ø—à–æ—Ç–∞ –æ—Ç –∫–∞–º–µ—Ä—ã
GET  /api/v1/gateway/health         - –ü—Ä–æ–≤–µ—Ä–∫–∞ Gateway
```

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤ –º–æ–¥—É–ª—è

```text
app/
‚îú‚îÄ‚îÄ main.py                    # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ FastAPI
‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îî‚îÄ‚îÄ gateway.py             # Gateway router (–ø—Ä–∏–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)
‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py            # –≠–∫—Å–ø–æ—Ä—Ç—ã –º–æ–¥—É–ª—è
‚îÇ   ‚îú‚îÄ‚îÄ config.py              # Pydantic Settings (–∑–∞–≥—Ä—É–∑–∫–∞ .env)
‚îÇ   ‚îú‚îÄ‚îÄ logger.py              # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ constants.py           # –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã (TTL, –ø–æ—Ä–æ–≥–∏, –ø—É—Ç–∏)
‚îÇ   ‚îú‚îÄ‚îÄ middleware.py          # Trace ID middleware
‚îÇ   ‚îî‚îÄ‚îÄ exceptions.py          # –ö–∞—Å—Ç–æ–º–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –∏ handlers
```

```text
# –ö–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞
‚îú‚îÄ‚îÄ docker-compose.yml         # –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è App + PostgreSQL (dev)
‚îú‚îÄ‚îÄ Dockerfile                 # Multi-stage —Å–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞
‚îú‚îÄ‚îÄ requirements.txt           # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python
‚îú‚îÄ‚îÄ .env.example               # –ü—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îî‚îÄ‚îÄ deploy/                    # Production –¥–µ–ø–ª–æ–π
    ‚îú‚îÄ‚îÄ docker-compose.prod.yml   # Production compose
    ‚îú‚îÄ‚îÄ deploy.sh                 # –°–∫—Ä–∏–ø—Ç –¥–µ–ø–ª–æ—è
    ‚îú‚îÄ‚îÄ nginx/                    # –ö–æ–Ω—Ñ–∏–≥–∏ nginx
    ‚îî‚îÄ‚îÄ scripts/                  # –°–∫—Ä–∏–ø—Ç—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
```

---

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)

```env
# Application
APP_NAME=SputnikFaceID
APP_VERSION=0.1.0
DEBUG=true

# Server
HOST=0.0.0.0
PORT=8000

# Database
DATABASE_URL=postgresql://sputnik:sputnik_password@db:5432/sputnik_faceid

# Logging
LOG_LEVEL=INFO

# Storage
STATIC_PATH=app/static
DEBUG_PHOTOS_TTL_DAYS=7

# Recognition thresholds
RECOGNITION_MATCH_THRESHOLD=0.55
RECOGNITION_LOW_CONFIDENCE_THRESHOLD=0.40
```

---

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (requirements.txt)

```txt
# Web Framework
fastapi>=0.104.0
uvicorn[standard]>=0.24.0

# Configuration
python-dotenv>=1.0.0
pydantic>=2.0.0
pydantic-settings>=2.0.0

# File uploads
python-multipart>=0.0.6

# Database
sqlalchemy>=2.0.0
psycopg2-binary>=2.9.9
alembic>=1.12.0

# HTTP Client
httpx>=0.25.0
```

---

## –ü—Ä–æ–≥—Ä–µ—Å—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

| –§–∞–∑–∞ | –°—Ç–∞—Ç—É—Å | –ó–∞–¥–∞—á–∏ |
|------|--------|--------|
| –§–∞–∑–∞ 1: –ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ | ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ | 4/4 |
| –§–∞–∑–∞ 2: FastAPI –∫–∞—Ä–∫–∞—Å | ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ | 4/4 |
| –§–∞–∑–∞ 3: Image Gateway | ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ | 4/4 |
| –§–∞–∑–∞ 4: Docker | ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ | 4/4 |
| –§–∞–∑–∞ 5: –£—Ç–∏–ª–∏—Ç—ã | ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ | 4/4 |
| –§–∞–∑–∞ 6: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è | üîÑ –í –ø—Ä–æ—Ü–µ—Å—Å–µ | 1/4 |
| –§–∞–∑–∞ 7: –î–µ–ø–ª–æ–π | üîÑ –í –ø—Ä–æ—Ü–µ—Å—Å–µ | 3/4 |

**–û–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å: 24/28 –∑–∞–¥–∞—á (86%)**
